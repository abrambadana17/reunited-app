{% extends "base.html" %}
{% block title %}Match Items - Reunited{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="dashboard-header mb-4">
    <h1 class="fw-bold mb-2">Match Items üïµÔ∏è‚Äç‚ôÇÔ∏è</h1>
    <p class="mb-0 opacity-75">Here are items matched with yours.</p>
  </div>

  <!-- Match Items Grid -->
  <div class="row g-4">
    {% for match in matches %}
    <div class="col-12 col-sm-6 col-lg-4">
      <div class="card shadow-sm h-100" style="min-height: 400px;">
        
        <!-- Images side by side -->
        <div class="d-flex" style="height:200px; overflow:hidden;">
          <img src="{{ url_for('static', filename=match.lost_image) if match.lost_image else url_for('static', filename='images/placeholder.png') }}" 
               class="w-50 border-end object-fit-cover" alt="Lost Item Image">
          <img src="{{ url_for('static', filename=match.found_image) if match.found_image else url_for('static', filename='images/placeholder.png') }}" 
               class="w-50 object-fit-cover" alt="Found Item Image">
        </div>

        <div class="card-body">
          <h5 class="card-title">
            {{ match.lost_title }} ‚Üî {{ match.found_title }}
          </h5>
          <p class="card-text small text-muted">
            Matched on: {{ match.match_at.strftime('%b %d, %Y') if match.match_at else 'N/A' }}
          </p>
          <p class="card-text">
            <b>Lost:</b> {{ match.lost_description }} <br>
            <b>Found:</b> {{ match.found_description }}
          </p>

          <!-- Match confidence -->
          {% set score = match.match_score %}
          {% if score >= 1 %}
            <span class="badge bg-success">‚úÖ Exact Match ({{ score }})</span>
          {% elif score >= 0.8 %}
            <span class="badge bg-success">Very High Possibility with ({{ score }}) Match Score</span>
          {% elif score >= 0.6 %}
            <span class="badge bg-success text-dark">High Possibility with ({{ score }}) Match Score</span>
          {% elif score >= 0.4 %}
            <span class="badge bg-warning">Medium Possibility with  ({{ score }}) Match Score</span>
          {% else %}
            <span class="badge bg-secondary">Below Threshold ({{ score }})</span>
          {% endif %}
        </div>

       <div class="card-footer d-flex justify-content-between align-items-center">
  <!-- Lost User -->
  <div class="d-flex align-items-center">
    <div class="user-avatar me-2">
      {% if match.lost_profile %}
        <img src="{{ url_for('static', filename='uploads/profile_pictures/' ~ match.lost_profile) }}" alt="Lost User">
      {% else %}
        {{ match.lost_first_name[0]|upper }}{{ match.lost_last_name[0]|upper }}
      {% endif %}
    </div>
    <small class="text-muted">{{ match.lost_first_name }} {{ match.lost_last_name }} (Lost)</small>
  </div>

  <!-- Found User -->
  <div class="d-flex align-items-center">
    <div class="user-avatar me-2">
      {% if match.found_profile %}
        <img src="{{ url_for('static', filename='uploads/profile_pictures/' ~ match.found_profile) }}" alt="Found User">
      {% else %}
        {{ match.found_first_name[0]|upper }}{{ match.found_last_name[0]|upper }}
      {% endif %}
    </div>
    <small class="text-muted">{{ match.found_first_name }} {{ match.found_last_name }} (Found)</small>
  </div>
</div>


      </div>
    </div>
    {% else %}
    <p class="text-muted">No matches found for your items yet.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
