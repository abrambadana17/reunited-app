{% extends "base.html" %}
{% block title %}Dashboard - Reunited{% endblock %}

<!-- Adding Bootstrap Icons CSS for icon display -->
{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="dashboard-header mb-4">
    <h1 class="fw-bold mb-2">Dashboard</h1>
    <p class="mb-0 opacity-75">Welcome to Reunited, {{ session.first_name }}!</p>
  </div>

  <!-- Stats Cards -->
  <div class="row g-4 mb-4">
    <!-- Items Posted -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="stats-card">
        <div class="stats-icon">
          <i class="bi bi-plus-circle text-info"></i>
        </div>
        <h2 class="stats-number text-info">{{ stats.total_posted }}</h2>
        <p class="mb-0 opacity-75">Items Posted</p>
      </div>
    </div>
    
    <!-- Items Found/Claimed -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="stats-card">
        <div class="stats-icon">
          <i class="bi bi-check-circle text-success"></i>
        </div>
        <h2 class="stats-number text-success">{{ stats.total_claimed }}</h2>
        <p class="mb-0 opacity-75">Items Claimed</p>
      </div>
    </div>
    
    <!-- Total Activity/Matches -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="stats-card">
        <div class="stats-icon">
          <i class="bi bi-puzzle" style="color: #9b59b6;"></i>
        </div>
        <h2 class="stats-number" style="color: #9b59b6;">{{ stats.total_activity }}</h2>
        <p class="mb-0 opacity-75">Potential Matches</p>
      </div>
    </div>
    
    <!-- Returned Items -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="stats-card">
        <div class="stats-icon">
          <i class="bi bi-arrow-return-left text-danger"></i>
        </div>
        <h2 class="stats-number text-danger">{{ stats.total_returned }}</h2>
        <p class="mb-0 opacity-75">Items Returned</p>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row g-4 mb-4">
    <!-- Report Lost Item -->
    <div class="col-12 col-lg-4">
      <div class="stats-card text-center">
        <div class="stats-icon mx-auto">
          <i class="bi bi-plus-circle text-info"></i>
        </div>
        <h4 class="mb-3">Report Lost Item</h4>
        <p class="mb-4 opacity-75">Lost something? Create a detailed report to help others find and return it.</p>
        <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#lostItemModal">
          <i class="bi bi-plus-circle me-2"></i>Report Lost Item
        </button>
      </div>
    </div>

    <!-- Report Found Item -->
    <div class="col-12 col-lg-4">
      <div class="stats-card text-center">
        <div class="stats-icon mx-auto">
          <i class="bi bi-search text-success"></i>
        </div>
        <h4 class="mb-3">Report Found Item</h4>
        <p class="mb-4 opacity-75">Found something? Help reunite it with its owner by reporting it here.</p>
        <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#foundItemModal">
          <i class="bi bi-search me-2"></i>Report Found Item
        </button>
      </div>
    </div>

    <!-- Share Feedback -->
    <div class="col-12 col-lg-4">
      <div class="stats-card text-center">
        <div class="stats-icon mx-auto">
          <i class="bi bi-chat-heart text-warning"></i>
        </div>
        <h4 class="mb-3">Share Feedback</h4>
        <p class="mb-4 opacity-75">Help us improve Reunited by sharing your experience and suggestions.</p>
        <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#feedbackModal">
          <i class="bi bi-chat-heart me-2"></i>Share Feedback
        </button>
      </div>
    </div>
  </div>

  <!-- Community Feedback -->
  {% if recent_feedback %}
  <div class="row mb-5">
    <div class="col-12">
      <div class="stats-card">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="mb-0">
            <i class="bi bi-chat-heart me-2"></i>Community Feedback
          </h4>
        </div>
        
        <div class="feedback-carousel-wrapper">
          <button class="carousel-control carousel-control-prev" onclick="previousFeedback()" id="prevBtn">
            <i class="bi bi-chevron-left"></i>
          </button>
          
          <button class="carousel-control carousel-control-next" onclick="nextFeedback()" id="nextBtn">
            <i class="bi bi-chevron-right"></i>
          </button>
          
          <div class="feedback-carousel-container">
            <div class="feedback-carousel" id="feedbackCarousel">
              {% for feedback in recent_feedback %}
              <div class="feedback-slide">
                <div class="feedback-card clickable-feedback" 
                     data-feedback-id="{{ feedback.id }}"
                     data-user-name="{{ feedback.first_name }} {{ feedback.last_name }}"
                     data-profile-picture="{% if feedback.profile_picture %}{{ url_for('uploaded_file', filename=feedback.profile_picture) }}{% endif %}"
                     data-rating="{{ feedback.rating }}"
                     data-message="{{ feedback.message }}"
                     data-date="{{ feedback.created_at.strftime('%b %d, %Y') }}">
                  <div class="feedback-header">
                    <div class="profile-picture">
                      {% if feedback.profile_picture %}
                        <img src="{{ url_for('uploaded_file', filename=feedback.profile_picture) }}" 
                             alt="{{ feedback.first_name }} {{ feedback.last_name }}" 
                             class="profile-img">
                      {% else %}
                        <div class="profile-placeholder">
                          <i class="bi bi-person-fill"></i>
                        </div>
                      {% endif %}
                    </div>
                    <div class="feedback-info">
                      <h6 class="user-name">{{ feedback.first_name }} {{ feedback.last_name }}</h6>
                      {% if feedback.rating %}
                      <div class="rating-display">
                        {% for i in range(feedback.rating) %}
                          <i class="bi bi-star-fill"></i>
                        {% endfor %}
                        {% for i in range(5 - feedback.rating) %}
                          <i class="bi bi-star"></i>
                        {% endfor %}
                      </div>
                      {% endif %}
                    </div>
                  </div>
                  <p class="feedback-message">{{ feedback.message }}</p>
                  <small class="feedback-date">{{ feedback.created_at.strftime('%b %d, %Y') }}</small>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

    <!-- Recent Activity -->
  {% if recent_items %}
  <div class="row mb-4">
    <div class="col-12">
      <div class="stats-card">
        <h4 class="mb-4">
          <i class="bi bi-clock-history me-2"></i>Recent Activity
        </h4>
        <div class="row g-3">
          {% for item in recent_items %}
          <div class="col-12 col-md-6 col-lg-4">
            <div class="card border-0 shadow-sm clickable-item" 
                 data-item-id="{{ item.id }}"
                 data-item-type="{{ item.type }}"
                 style="cursor: pointer;"
                 onclick="redirectToItemPage('{{ item.type }}', '{{ item.id }}')">
              {% if item.image_path %}
              <img src="{{ url_for('static', filename='uploads/items/' + item.image_path.split('/')[-1]) }}" 
                   class="card-img-top" style="height: 150px; object-fit: cover;">
              {% else %}
              <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                   style="height: 150px;">
                <i class="bi bi-image fs-1 text-muted"></i>
              </div>
              {% endif %}
              <div class="card-body">
                <h6 class="card-title mb-2">{{ item.title }}</h6>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge {% if item.type == 'lost' %}bg-info{% else %}bg-success{% endif %}">
                    {{ item.type.title() }}
                  </span>
                  <small class="text-muted">{{ item.created_at.strftime('%b %d') }}</small>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<!-- Feedback Detail Modal -->
<div class="modal fade" id="feedbackDetailModal" tabindex="-1" aria-labelledby="feedbackDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div class="d-flex align-items-center">
          <div class="modal-profile-picture me-3" id="modalProfilePicture">
            <!-- Profile picture will be inserted here -->
          </div>
          <div>
            <h5 class="modal-title fw-bold mb-1" id="modalUserName">User Name</h5>
            <div class="rating-display" id="modalRating">
              <!-- Rating stars will be inserted here -->
            </div>
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="feedback-full-message mb-3" id="modalFullMessage"></p>
        <small class="text-muted" id="modalDate"></small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Item Detail Modal -->
<div class="modal fade" id="itemDetailModal" tabindex="-1" aria-labelledby="itemDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="modalItemTitle">Item Title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Item Image -->
          <div class="col-12 col-md-6 mb-3">
            <div class="item-image-container text-center" id="modalImageContainer">
              <!-- Image or placeholder will be inserted here -->
            </div>
          </div>
          
          <!-- Item Details -->
          <div class="col-12 col-md-6">
            <div class="item-details">
              <div class="mb-3">
                <span class="badge fs-6" id="modalItemType">Type</span>
              </div>
              
              <div class="mb-3">
                <strong>Category:</strong>
                <span id="modalItemCategory" class="ms-2">Category</span>
              </div>
              
              <div class="mb-3">
                <strong>Location:</strong>
                <span id="modalItemLocation" class="ms-2">Location</span>
              </div>
              
              <div class="mb-3">
                <strong>Date:</strong>
                <span id="modalItemDate" class="ms-2">Date</span>
              </div>
              
              <div class="mb-3" id="modalRewardSection" style="display: none;">
                <strong>Reward:</strong>
                <span id="modalItemReward" class="ms-2 text-success fw-bold">Reward</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Description -->
        <div class="row mt-3">
          <div class="col-12">
            <div class="description-section">
              <h6 class="fw-bold mb-2">Description:</h6>
              <p id="modalItemDescription" class="text-muted">Description will appear here...</p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form action="{{ url_for('submit_feedback') }}" method="POST">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="feedbackModalLabel">Share Your Feedback</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Your Experience</label>
            <textarea name="message" class="form-control" rows="4" 
                      placeholder="Tell us about your experience with Reunited..." required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Rating (Optional)</label>
            <div class="rating-stars">
              <input type="radio" name="rating" value="1" id="star1">
              <label for="star1" class="star">
                <i class="bi bi-star-fill"></i>
              </label>
              <input type="radio" name="rating" value="2" id="star2">
              <label for="star2" class="star">
                <i class="bi bi-star-fill"></i>
              </label>
              <input type="radio" name="rating" value="3" id="star3">
              <label for="star3" class="star">
                <i class="bi bi-star-fill"></i>
              </label>
              <input type="radio" name="rating" value="4" id="star4">
              <label for="star4" class="star">
                <i class="bi bi-star-fill"></i>
              </label>
              <input type="radio" name="rating" value="5" id="star5">
              <label for="star5" class="star">
                <i class="bi bi-star-fill"></i>
              </label>
            </div>
          </div>
          <div class="mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="is_public" value="1" id="publicFeedback" checked>
              <label class="form-check-label" for="publicFeedback">
                Make this feedback public (visible to other users)
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn-primary-custom">Submit Feedback</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Lost Item Modal -->
<div class="modal fade" id="lostItemModal" tabindex="-1" aria-labelledby="lostItemModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form action="{{ url_for('lost') }}" method="POST" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="lostItemModalLabel">Report Lost Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Item Title</label>
            <input type="text" name="title" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-select" required>
              <option value="">Select category</option>
              <option value="Electronics">Electronics</option>
              <option value="Wallet">Wallet</option>
              <option value="Keys">Keys</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Location Lost</label>
            <input type="text" name="location_reported" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Reward (Optional)</label>
            <input type="text" name="reward" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Upload Item Image</label>
            <input type="file" name="image" class="form-control" accept="image/*" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Submit Lost Item</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Found Item Modal -->
<div class="modal fade" id="foundItemModal" tabindex="-1" aria-labelledby="foundItemModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form action="{{ url_for('found') }}" method="POST" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="foundItemModalLabel">Report Found Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Item Title</label>
            <input type="text" name="title" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-select" required>
              <option value="">Select category</option>
              <option value="Electronics">Electronics</option>
              <option value="Wallet">Wallet</option>
              <option value="Keys">Keys</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Location Found</label>
            <input type="text" name="location_reported" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Upload Item Image</label>
            <input type="file" name="image" class="form-control" accept="image/*" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary-custom">Submit Found Item</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Function to redirect to item pages - MUST BE GLOBAL
function redirectToItemPage(itemType, itemId) {
  if (itemType === 'lost') {
    window.location.href = "{{ url_for('lost') }}?show_item=" + itemId;
  } else {
    window.location.href = "{{ url_for('found') }}?show_item=" + itemId;
  }
}

document.addEventListener("DOMContentLoaded", function () {
  if (window.location.hash === "#lostItemModal") {
    const modal = new bootstrap.Modal(document.getElementById('lostItemModal'));
    modal.show();
  }
  if (window.location.hash === "#foundItemModal") {
    const modal = new bootstrap.Modal(document.getElementById('foundItemModal'));
    modal.show();
  }
  if (window.location.hash === "#feedbackModal") {
    const modal = new bootstrap.Modal(document.getElementById('feedbackModal'));
    modal.show();
  }

  const stars = document.querySelectorAll('.rating-stars input[type="radio"]');
  const starLabels = document.querySelectorAll('.rating-stars .star');
  
  starLabels.forEach((label, index) => {
    label.addEventListener('click', function() {
      const rating = index + 1;
      stars[rating - 1].checked = true;
      updateStarDisplay();
    });
    
    label.addEventListener('mouseover', function() {
      starLabels.forEach((star, i) => {
        if (i <= index) {
          star.querySelector('i').className = 'bi bi-star-fill';
          star.style.color = 'var(--color-warning)';
        } else {
          star.querySelector('i').className = 'bi bi-star';
          star.style.color = 'var(--color-gray-300)';
        }
      });
    });
  });
  
  document.querySelector('.rating-stars').addEventListener('mouseleave', function() {
    updateStarDisplay();
  });
  
  function updateStarDisplay() {
    const checkedStar = document.querySelector('.rating-stars input[type="radio"]:checked');
    if (checkedStar) {
      const rating = parseInt(checkedStar.value);
      starLabels.forEach((star, i) => {
        if (i < rating) {
          star.querySelector('i').className = 'bi bi-star-fill';
          star.style.color = 'var(--color-warning)';
        } else {
          star.querySelector('i').className = 'bi bi-star';
          star.style.color = 'var(--color-gray-300)';
        }
      });
    } else {
      starLabels.forEach(star => {
        star.querySelector('i').className = 'bi bi-star';
        star.style.color = 'var(--color-gray-300)';
      });
    }
  }

  let currentSlide = 0;
  const carousel = document.getElementById('feedbackCarousel');
  const slides = document.querySelectorAll('.feedback-slide');
  
  function getVisibleSlides() {
    const width = window.innerWidth;
    if (width >= 1200) return 3;
    if (width >= 768) return 2;
    return 1;
  }
  
  function updateCarousel() {
    if (carousel && slides.length > 0) {
      const visibleSlides = getVisibleSlides();
      const slideWidth = carousel.offsetWidth / visibleSlides;
      const maxSlide = Math.max(0, slides.length - visibleSlides);
      
      if (currentSlide > maxSlide) {
        currentSlide = maxSlide;
      }
      
      carousel.style.transform = `translateX(-${currentSlide * slideWidth}px)`;
      
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      
      if (prevBtn) prevBtn.disabled = currentSlide === 0;
      if (nextBtn) nextBtn.disabled = currentSlide >= maxSlide;
    }
  }
  
  window.nextFeedback = function() {
    const visibleSlides = getVisibleSlides();
    const maxSlide = Math.max(0, slides.length - visibleSlides);
    if (currentSlide < maxSlide) {
      currentSlide++;
      updateCarousel();
    }
  };
  
  window.previousFeedback = function() {
    if (currentSlide > 0) {
      currentSlide--;
      updateCarousel();
    }
  };
  
  window.addEventListener('resize', updateCarousel);
  
  updateCarousel();

  // Feedback modal functionality
  const feedbackCards = document.querySelectorAll('.clickable-feedback');
  const feedbackModal = new bootstrap.Modal(document.getElementById('feedbackDetailModal'));
  
  feedbackCards.forEach(card => {
    card.addEventListener('click', function() {
      const userName = this.getAttribute('data-user-name');
      const profilePicture = this.getAttribute('data-profile-picture');
      const rating = parseInt(this.getAttribute('data-rating'));
      const message = this.getAttribute('data-message');
      const date = this.getAttribute('data-date');
      
      // Populate modal with data
      document.getElementById('modalUserName').textContent = userName;
      document.getElementById('modalFullMessage').textContent = message;
      document.getElementById('modalDate').textContent = date;
      
      // Handle profile picture
      const modalProfilePicture = document.getElementById('modalProfilePicture');
      modalProfilePicture.innerHTML = ''; // Clear previous content
      
      if (profilePicture) {
        const img = document.createElement('img');
        img.src = profilePicture;
        img.alt = userName;
        img.className = 'modal-profile-img';
        modalProfilePicture.appendChild(img);
      } else {
        const placeholder = document.createElement('div');
        placeholder.className = 'modal-profile-placeholder';
        placeholder.innerHTML = '<i class="bi bi-person-fill"></i>';
        modalProfilePicture.appendChild(placeholder);
      }
      
      // Handle rating
      const modalRating = document.getElementById('modalRating');
      modalRating.innerHTML = ''; // Clear previous stars
      
      if (rating) {
        for (let i = 0; i < rating; i++) {
          const star = document.createElement('i');
          star.className = 'bi bi-star-fill';
          modalRating.appendChild(star);
        }
        for (let i = 0; i < (5 - rating); i++) {
          const star = document.createElement('i');
          star.className = 'bi bi-star';
          modalRating.appendChild(star);
        }
      } else {
        modalRating.innerHTML = '<span class="text-muted">No rating</span>';
      }
      
      // Show modal
      feedbackModal.show();
    });
  });
  
  // Prevent carousel controls from triggering card clicks
  const carouselControls = document.querySelectorAll('.carousel-control');
  carouselControls.forEach(control => {
    control.addEventListener('click', function(e) {
      e.stopPropagation();
    });
  });
});
</script>

<style>
.rating-stars {
  display: flex;
  flex-direction: row;
  justify-content: flex-start;
}

.rating-stars input[type="radio"] {
  display: none;
}

.rating-stars .star {
  cursor: pointer;
  font-size: 1.5rem;
  color: #dee2e6;
  margin-right: 0.25rem;
  transition: color 0.2s;
}

.rating-stars .star:hover {
  color: #ffc107;
}

.rating-stars .star i {
  transition: all 0.2s ease;
}

.stats-icon {
  background: transparent !important;
  font-size: 1.5rem;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  margin-bottom: 1rem;
}

/* Community Feedback Section */
.feedback-carousel-wrapper {
  position: relative;
  padding: 0 40px;
  margin: 16px 0;
}

.carousel-control {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: #fff;
  border: 2px solid #007bff;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 15;
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.25);
  color: #007bff;
  font-size: 16px;
}

.carousel-control:hover:not(:disabled) {
  background: #007bff;
  color: #fff;
  box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
  transform: translateY(-50%) scale(1.1);
}

.carousel-control:disabled {
  opacity: 0.3;
  cursor: not-allowed;
  transform: translateY(-50%);
  background: #f8f9fa;
  border-color: #dee2e6;
  color: #6c757d;
}

.carousel-control-prev {
  left: 8px;
}

.carousel-control-next {
  right: 8px;
}

.feedback-carousel-container {
  overflow: hidden;
  width: 100%;
  border-radius: 8px;
}

.feedback-carousel {
  display: flex;
  transition: transform 0.4s ease;
  gap: 16px;
}

.feedback-slide {
  flex-shrink: 0;
  width: 100%;
}

/* Responsive slide widths */
@media (min-width: 1200px) {
  .feedback-slide {
    width: calc((100% - 32px) / 3);
  }
}

@media (min-width: 768px) and (max-width: 1199px) {
  .feedback-slide {
    width: calc((100% - 16px) / 2);
  }
}

/* Mobile Responsive Improvements */
@media (max-width: 767px) {
  .feedback-slide {
    width: 100%;
    padding: 0 8px;
  }
  
  .feedback-carousel-wrapper {
    padding: 0 20px;
  }
  
  .carousel-control {
    width: 32px;
    height: 32px;
    font-size: 14px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
    border: 1px solid #dee2e6;
  }
  
  .carousel-control-prev {
    left: -10px;
  }
  
  .carousel-control-next {
    right: -10px;
  }
  
  .feedback-carousel {
    gap: 12px;
  }
}

/* Clickable feedback cards */
.clickable-feedback {
  cursor: pointer;
  transition: all 0.3s ease;
}

.clickable-feedback:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}

/* Clickable item cards */
.clickable-item {
  cursor: pointer;
  transition: all 0.3s ease;
}

.clickable-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.feedback-card {
  background: #fff;
  border: 1px solid #e9ecef;
  border-radius: 12px;
  padding: 20px;
  height: 100%;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  min-height: 200px;
  display: flex;
  flex-direction: column;
}

.feedback-card:hover {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  transform: translateY(-4px);
}

@media (max-width: 767px) {
  .feedback-card {
    padding: 16px;
    min-height: 180px;
  }
}

.feedback-header {
  display: flex;
  align-items: flex-start;
  margin-bottom: 12px;
  min-height: 48px;
}

@media (max-width: 767px) {
  .feedback-header {
    align-items: center;
    margin-bottom: 10px;
    min-height: 44px;
  }
}

.profile-picture {
  width: 48px;
  height: 48px;
  margin-right: 12px;
  flex-shrink: 0;
}

@media (max-width: 767px) {
  .profile-picture {
    width: 40px;
    height: 40px;
    margin-right: 10px;
  }
}

.profile-img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #e9ecef;
}

.profile-placeholder {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
}

@media (max-width: 767px) {
  .profile-placeholder {
    font-size: 16px;
  }
}

.feedback-info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  overflow: hidden;
}

.user-name {
  margin: 0 0 4px 0;
  font-weight: 600;
  font-size: 15px;
  color: #2c3e50;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

@media (max-width: 767px) {
  .user-name {
    font-size: 14px;
    margin-bottom: 3px;
  }
}

.rating-display {
  color: #ffc107;
  font-size: 13px;
  line-height: 1;
  display: flex;
  flex-wrap: nowrap;
}

.rating-display i {
  margin-right: 1px;
  flex-shrink: 0;
}

@media (max-width: 767px) {
  .rating-display {
    font-size: 12px;
  }
  
  .rating-display i {
    margin-right: 0;
  }
}

.feedback-message {
  margin: 0 0 12px 0;
  font-size: 14px;
  line-height: 1.5;
  color: #495057;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  flex: 1;
  min-height: 60px;
}

@media (max-width: 767px) {
  .feedback-message {
    font-size: 13px;
    line-height: 1.4;
    -webkit-line-clamp: 3;
    min-height: 55px;
    margin-bottom: 10px;
  }
}

.feedback-date {
  color: #6c757d;
  font-size: 12px;
  font-weight: 500;
  margin-top: auto;
}

@media (max-width: 767px) {
  .feedback-date {
    font-size: 11px;
  }
}

/* Modal specific styles */
.modal-profile-picture {
  width: 60px;
  height: 60px;
  flex-shrink: 0;
}

.modal-profile-img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #e9ecef;
}

.modal-profile-placeholder {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 24px;
  border: 3px solid #e9ecef;
}

.feedback-full-message {
  font-size: 16px;
  line-height: 1.6;
  color: #495057;
  white-space: pre-line;
}

/* Item modal styles */
.item-image-container {
  border-radius: 8px;
  overflow: hidden;
}

.item-details {
  padding: 10px 0;
}

.item-details strong {
  color: #2c3e50;
  font-weight: 600;
}

.description-section {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
  border-left: 4px solid #007bff;
}

/* Mobile responsive for modals */
@media (max-width: 767px) {
  .modal-profile-picture {
    width: 50px;
    height: 50px;
  }
  
  .modal-profile-placeholder {
    font-size: 20px;
  }
  
  .feedback-full-message {
    font-size: 14px;
  }
  
  #modalUserName {
    font-size: 16px;
  }
  
  .item-image-container img {
    max-height: 200px !important;
    height: 200px !important;
  }
  
  .modal-body .row {
    gap: 15px;
  }
  
  .description-section {
    margin-top: 15px;
  }
}

/* Ensure modal rating stars are properly sized */
#modalRating {
  font-size: 16px;
}

#modalRating i {
  margin-right: 2px;
}

@media (max-width: 767px) {
  #modalRating {
    font-size: 14px;
  }
}

/* Ensure proper badge sizing in modal */
#modalItemType {
  font-size: 14px !important;
  padding: 8px 12px;
}
</style>

{% endblock %}